name: Check + åˆéš/é€²éš ä»»å‹™é©—è­‰
on:
  push:
    branches: ['*']
  pull_request:
    branches: ['*']

jobs:
  # --- åˆéš ä»»å‹™é©—è­‰éšæ®µ ---
  validate-missions:
    name: é©—è­‰åˆéšä»»å‹™ 7 é¡Œ
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Task 1 - Check website title
        run: |
          echo "ğŸ“‹ é¡Œç›® 1ï¼šæª¢æŸ¥ç¶²ç«™ Title"
          if grep -q "<title>LiveFit</title>" frontend/index.html; then
            echo "âœ… é€šéï¼šTitle å·²æ”¹ç‚º LiveFit"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ frontend/index.html ä¸­çš„ <title>LiveFit+</title> æ”¹ç‚º <title>LiveFit</title>"
            exit 1
          fi

      - name: Task 2 - Check logo image
        run: |
          echo "ğŸ“‹ é¡Œç›® 2ï¼šæª¢æŸ¥ç¶²ç«™ Logo"
          if grep -q "logo-text-v2.png" frontend/src/layouts/LayoutHeader.vue; then
            echo "âœ… é€šéï¼šLogo å·²æ”¹ç‚º logo-text-v2.png"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ frontend/src/layouts/LayoutHeader.vue ä¸­çš„ logo-text.png æ”¹ç‚º logo-text-v2.png"
            exit 1
          fi

      - name: Task 3 - Check JWT expiration
        run: |
          echo "ğŸ“‹ é¡Œç›® 3ï¼šæª¢æŸ¥ Token éæœŸè¨­å®š"
          if grep -q "JWT_EXPIRES_DAY=7d" .env.example; then
            echo "âœ… é€šéï¼šJWT_EXPIRES_DAY å·²æ”¹ç‚º 7d"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ .env.example ä¸­çš„ JWT_EXPIRES_DAY=30d æ”¹ç‚º JWT_EXPIRES_DAY=7d"
            exit 1
          fi

      - name: Task 4 - Check Entity comment
        run: |
          echo "ğŸ“‹ é¡Œç›® 4ï¼šæª¢æŸ¥ Entity æ¬„ä½èªªæ˜"
          if head -10 backend/entities/CreditPackages.js | grep -q "å ‚æ•¸æ–¹æ¡ˆè³‡æ–™è¡¨"; then
            echo "âœ… é€šéï¼šå·²æ–°å¢æ¬„ä½èªªæ˜è¨»è§£"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹åœ¨ backend/entities/CreditPackages.js æª”æ¡ˆæœ€ä¸Šæ–¹æ–°å¢æ¬„ä½èªªæ˜è¨»è§£"
            exit 1
          fi

      - name: Task 5 - Check password length
        run: |
          echo "ğŸ“‹ é¡Œç›® 5ï¼šæª¢æŸ¥å¯†ç¢¼é•·åº¦é™åˆ¶"
          if grep -q "\.{10,16}" backend/controllers/users.js; then
            echo "âœ… é€šéï¼šå¯†ç¢¼é•·åº¦å·²æ”¹ç‚º 10-16"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ backend/controllers/users.js ä¸­çš„ .{8,16} æ”¹ç‚º .{10,16}"
            exit 1
          fi

      - name: Task 6 - Check API total field
        run: |
          echo "ğŸ“‹ é¡Œç›® 6ï¼šæª¢æŸ¥ API å›å‚³ç¸½ç­†æ•¸"
          if grep -q "total: creditPackage.length" backend/controllers/creditPackage.js; then
            echo "âœ… é€šéï¼šå·²æ–°å¢ total æ¬„ä½"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹åœ¨ backend/controllers/creditPackage.js çš„ getAll å‡½æ•¸ä¸­æ–°å¢ total: creditPackage.length"
            exit 1
          fi

      - name: Task 7 - Check healthcheck response
        run: |
          echo "ğŸ“‹ é¡Œç›® 7ï¼šæª¢æŸ¥å¥åº·æª¢æŸ¥å›å‚³æ ¼å¼"
          if grep -A5 "app.get('/healthcheck'" backend/app.js | grep -q "res.status(200).json"; then
            echo "âœ… é€šéï¼šhealthcheck å·²æ”¹ç‚º JSON æ ¼å¼"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ backend/app.js ä¸­çš„ healthcheck è·¯ç”±æ”¹ç‚ºå›å‚³ JSON æ ¼å¼"
            exit 1
          fi

      - name: All missions completed
        run: |
          echo ""
          echo "ğŸ‰ğŸ‰ğŸ‰ æ­å–œï¼åˆéšä»»å‹™å…¨éƒ¨é€šéï¼ğŸ‰ğŸ‰ğŸ‰"
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘           åˆéšä»»å‹™é©—è­‰çµæœ                          â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  é¡Œç›® 1ï¼šä¿®æ”¹ç¶²ç«™ Title              âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 2ï¼šæ›´æ›ç¶²ç«™ Logo               âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 3ï¼šä¿®æ”¹ Token éæœŸè¨­å®š         âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 4ï¼šæ–°å¢ Entity æ¬„ä½èªªæ˜        âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 5ï¼šä¿®æ”¹å¯†ç¢¼é•·åº¦é™åˆ¶            âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 6ï¼šæ–°å¢ API å›å‚³ç¸½ç­†æ•¸         âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 7ï¼šä¿®æ”¹å¥åº·æª¢æŸ¥å›å‚³æ ¼å¼        âœ… é€šé        â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  âœ… å…¨éƒ¨ 7 é¡Œé€šéï¼                                 â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # --- é€²éš ä»»å‹™é©—è­‰éšæ®µ ---
  validate-screenshots:
    name: é©—è­‰é€²éšä»»å‹™ 9 é¡Œ
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check screenshots folder exists
        run: |
          echo "ğŸ“ æª¢æŸ¥ screenshots è³‡æ–™å¤¾æ˜¯å¦å­˜åœ¨"
          if [ -d "screenshots" ]; then
            echo "âœ… screenshots è³‡æ–™å¤¾å­˜åœ¨"
          else
            echo "âš ï¸ screenshots è³‡æ–™å¤¾ä¸å­˜åœ¨ï¼Œè·³éé€²éšä»»å‹™é©—è­‰"
            echo "ğŸ’¡ æç¤ºï¼šå¦‚æœæ‚¨åªå®Œæˆåˆéšä»»å‹™ (LV1)ï¼Œå¯ä»¥å¿½ç•¥æ­¤æª¢æŸ¥"
            echo "SKIP_VALIDATION=true" >> $GITHUB_ENV
          fi

      - name: Check screenshot 01 - Register
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 1ï¼šæª¢æŸ¥è¨»å†ŠæˆåŠŸæˆªåœ–"
          if [ -f "screenshots/01-register.png" ] || [ -f "screenshots/01-register.jpg" ] || [ -f "screenshots/01-register.jpeg" ]; then
            echo "âœ… é€šéï¼š01-register æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/01-register.pngï¼ˆå…©å€‹å¸³è™Ÿè¨»å†ŠæˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 02 - Add Credit Package
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 2ï¼šæª¢æŸ¥æ–°å¢çµ„åˆåŒ…æ–¹æ¡ˆæˆªåœ–"
          if [ -f "screenshots/02-add-credit-package.png" ] || [ -f "screenshots/02-add-credit-package.jpg" ] || [ -f "screenshots/02-add-credit-package.jpeg" ]; then
            echo "âœ… é€šéï¼š02-add-credit-package æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/02-add-credit-package.pngï¼ˆDBeaver æ–°å¢çµ„åˆåŒ…æ–¹æ¡ˆæˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 03 - Add Skill
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 3ï¼šæª¢æŸ¥æ–°å¢æŠ€èƒ½æˆªåœ–"
          if [ -f "screenshots/03-add-skill.png" ] || [ -f "screenshots/03-add-skill.jpg" ] || [ -f "screenshots/03-add-skill.jpeg" ]; then
            echo "âœ… é€šéï¼š03-add-skill æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/03-add-skill.pngï¼ˆå¾Œå°æ–°å¢æŠ€èƒ½æˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 04 - Upgrade Coach
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 4ï¼šæª¢æŸ¥å‡ç´šæ•™ç·´æˆªåœ–"
          if [ -f "screenshots/04-upgrade-coach.png" ] || [ -f "screenshots/04-upgrade-coach.jpg" ] || [ -f "screenshots/04-upgrade-coach.jpeg" ]; then
            echo "âœ… é€šéï¼š04-upgrade-coach æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/04-upgrade-coach.pngï¼ˆæ•™ç·´è³‡æ ¼ç®¡ç†å‡ç´šæˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 05 - Create Course
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 5ï¼šæª¢æŸ¥æ•™ç·´é–‹èª²æˆªåœ–"
          if [ -f "screenshots/05-create-course.png" ] || [ -f "screenshots/05-create-course.jpg" ] || [ -f "screenshots/05-create-course.jpeg" ]; then
            echo "âœ… é€šéï¼š05-create-course æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/05-create-course.pngï¼ˆæ•™ç·´é–‹èª²æˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 06 - Buy Credits
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 6ï¼šæª¢æŸ¥è³¼è²·å ‚æ•¸æˆªåœ–"
          if [ -f "screenshots/06-buy-credits.png" ] || [ -f "screenshots/06-buy-credits.jpg" ] || [ -f "screenshots/06-buy-credits.jpeg" ]; then
            echo "âœ… é€šéï¼š06-buy-credits æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/06-buy-credits.pngï¼ˆå­¸å“¡è³¼è²·å ‚æ•¸æˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 07 - Book Course
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 7ï¼šæª¢æŸ¥é ç´„èª²ç¨‹æˆªåœ–"
          if [ -f "screenshots/07-book-course.png" ] || [ -f "screenshots/07-book-course.jpg" ] || [ -f "screenshots/07-book-course.jpeg" ]; then
            echo "âœ… é€šéï¼š07-book-course æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/07-book-course.pngï¼ˆå­¸å“¡é ç´„èª²ç¨‹æˆåŠŸï¼‰"
            exit 1
          fi

      - name: Check screenshot 08 - Booking Record
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo "ğŸ“‹ æˆªåœ– 8ï¼šæª¢æŸ¥é ç´„ç´€éŒ„æˆªåœ–"
          if [ -f "screenshots/08-booking-record.png" ] || [ -f "screenshots/08-booking-record.jpg" ] || [ -f "screenshots/08-booking-record.jpeg" ]; then
            echo "âœ… é€šéï¼š08-booking-record æˆªåœ–å·²ä¸Šå‚³"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹ä¸Šå‚³ screenshots/08-booking-record.pngï¼ˆé ç´„ç´€éŒ„ç•«é¢ï¼‰"
            exit 1
          fi

      - name: All advanced missions completed
        if: env.SKIP_VALIDATION != 'true'
        run: |
          echo ""
          echo "ğŸ‰ğŸ‰ğŸ‰ æ­å–œï¼é€²éšä»»å‹™æˆªåœ–å…¨éƒ¨ä¸Šå‚³å®Œæˆï¼ğŸ‰ğŸ‰ğŸ‰"
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘              é€²éšä»»å‹™æˆªåœ–é©—è­‰çµæœ                       â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  æˆªåœ– 1ï¼šå…©å€‹å¸³è™Ÿè¨»å†ŠæˆåŠŸ              âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 2ï¼šDBeaver æ–°å¢çµ„åˆåŒ…æ–¹æ¡ˆæˆåŠŸ    âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 3ï¼šå¾Œå°æ–°å¢æŠ€èƒ½æˆåŠŸ              âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 4ï¼šæ•™ç·´è³‡æ ¼ç®¡ç†å‡ç´šæˆåŠŸ          âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 5ï¼šæ•™ç·´é–‹èª²æˆåŠŸ                  âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 6ï¼šå­¸å“¡è³¼è²·å ‚æ•¸æˆåŠŸ              âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 7ï¼šå­¸å“¡é ç´„èª²ç¨‹æˆåŠŸ              âœ… å·²ä¸Šå‚³        â•‘"
          echo "â•‘  æˆªåœ– 8ï¼šé ç´„ç´€éŒ„ç•«é¢                  âœ… å·²ä¸Šå‚³        â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  âœ… å…¨éƒ¨ 8 å¼µæˆªåœ–å·²ä¸Šå‚³ï¼                               â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ† æ­å–œå®Œæˆ LV2 é€²éšä»»å‹™ï¼"

      - name: Skip message
        if: env.SKIP_VALIDATION == 'true'
        run: |
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘              é€²éšä»»å‹™æˆªåœ–é©—è­‰çµæœ                       â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  âš ï¸  æœªåµæ¸¬åˆ° screenshots è³‡æ–™å¤¾                        â•‘"
          echo "â•‘                                                        â•‘"
          echo "â•‘  å¦‚æœæ‚¨åªå®Œæˆ LV1 åˆéšä»»å‹™ï¼Œå¯ä»¥å¿½ç•¥æ­¤è¨Šæ¯              â•‘"
          echo "â•‘  å¦‚æœæ‚¨è¦å®Œæˆ LV2 é€²éšä»»å‹™ï¼Œè«‹ï¼š                        â•‘"
          echo "â•‘  1. å»ºç«‹ screenshots è³‡æ–™å¤¾                            â•‘"
          echo "â•‘  2. ä¸Šå‚³ 8 å¼µæˆªåœ–ï¼ˆ01-register.png ~ 08-booking-record.pngï¼‰â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # --- åŸæœ¬çš„ Build éšæ®µ ---
  build :
    name: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to Repo Directory
        uses: actions/checkout@v4
      - name: Use Node.js 24
        uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json
      - name: Restore cache node modules
        id: cache
        uses: actions/cache/restore@v4
        with:
          path: backend/node_modules
          key: ${{ runner.os }}-node-backend-${{ hashFiles('package-lock.json') }}
      - name: Install dependencies
        working-directory: backend
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci
      - name: update cache node modules
        if: steps.cache.outputs.cache-hit != 'true'
        uses: actions/cache/save@v4
        with:
          path: backend/node_modules
          key: ${{ runner.os }}-node-backend-${{ hashFiles('package-lock.json') }}

  eslint-scan :
    name: Eslint Scanning
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to Repo Directory
        uses: actions/checkout@v4
      - name: Use Node.js 22
        uses: actions/setup-node@v6
        with:
          node-version: '22'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json
      - name: Restore cache node modules
        id: cache
        uses: actions/cache/restore@v4
        with:
          path: backend/node_modules
          key: ${{ runner.os }}-node-backend-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-backend-
      - name: Eslint Scan
        uses: reviewdog/action-eslint@v1
        with:
          workdir: ./backend
          reporter: github-check

  integration-test:
    name: Run integration Test
    needs: [build]
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      statuses: write
    env:
      DB_USERNAME: root
      DB_DATABASE: test
      DB_PASSWORD: test
      DB_HOST: localhost
      DB_PORT: 5432
    services:
      postgres:
        image: postgres:17-alpine
        ports:
          - 5432:5432
        env:
          POSTGRES_USER: ${{ env.DB_USERNAME }}
          POSTGRES_PASSWORD: ${{ env.DB_PASSWORD }}
          POSTGRES_DB: ${{ env.DB_DATABASE }}
    steps:
      - name: Checkout to Repo Directory
        uses: actions/checkout@v4
      - name: Use Node.js 24
        uses: actions/setup-node@v6
        with:
          node-version: '24'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json
      - name: Restore cache node modules
        id: cache
        uses: actions/cache/restore@v4
        with:
          path: backend/node_modules
          key: ${{ runner.os }}-node-backend-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-backend-
      - name: Make env file
        uses: SpicyPizza/create-envfile@v1
        with:
          envkey_NODE_ENV: production
          envkey_DB_HOST: ${{ env.DB_HOST }}
          envkey_DB_PORT: ${{ env.DB_PORT }}
          envkey_DB_DATABASE: ${{ env.DB_DATABASE }}
          envkey_DB_USERNAME: ${{ env.DB_USERNAME }}
          envkey_DB_PASSWORD: ${{ env.DB_PASSWORD }}
          envkey_DB_SYNCHRONIZE: true
          envkey_DB_ENABLE_SSL: false
          envkey_JWT_SECRET: hexschool666
          envkey_JWT_EXPIRES_DAY: 30d
          envkey_LOG_LEVEL: debug
          envkey_FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          envkey_FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          envkey_PORT: 3000
          directory: backend
          file_name: .env
      # - name: init schema
      #   working-directory: backend
      #   run: npm run init:schema
      - name: test server
        working-directory: backend
        run: npm run test:integration
      - name: upload coverage report
        uses: actions/upload-artifact@v4
        with:
          name: IntegrationTest Coverage report
          path: backend/coverage
          retention-days: 1
      - name: Integration Test Coverage monitor
        uses: slavcodev/coverage-monitor-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          coverage_path: "backend/coverage/clover.xml"
          threshold_alert: 10
          threshold_warning: 50
          comment_context: 'Integration Test Report'
